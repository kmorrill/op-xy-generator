<!DOCTYPE html>
<html>
  <head>
    <title>OP-XY MIDI Control</title>
    <style>
      .patch-controls {
        margin: 20px 0;
        border-collapse: collapse;
      }

      .patch-controls td {
        padding: 8px;
        vertical-align: middle;
      }

      .patch-controls td:first-child {
        width: 120px;
      }

      .patch-controls input[type="range"] {
        width: 200px;
      }

      .patch-controls select {
        width: 200px;
        padding: 4px;
      }

      .patch-controls span {
        min-width: 40px;
        display: inline-block;
      }

      #patch-details {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #patch-details h2 {
        margin-top: 0;
      }

      #patch-details ul {
        list-style-type: none;
        padding: 0;
      }

      #patch-details ul li {
        margin-bottom: 10px;
      }
    </style>
    <script src="patch_generator_opxy.js" defer></script>
    <script src="patch_generator_gen.js" defer></script>
  </head>
  <body>
    <div id="status"></div>

    <table class="patch-controls">
      <tr>
        <td>Patch Type:</td>
        <td colspan="2">
          <select id="patchType">
            <option value="lead">Lead</option>
            <option value="bass">Bass</option>
            <option value="pad">Pad</option>
            <option value="pluck">Pluck</option>
            <option value="fx">FX</option>
          </select>
        </td>
        <td>
          <span
            >Defines the overall role of the sound, such as melodic leads,
            basslines, atmospheric pads, sharp plucks, or sound effects.</span
          >
        </td>
      </tr>
      <tr>
        <td>Synth Engine:</td>
        <td colspan="2">
          <select id="engineType">
            <option value="random">Random</option>
            <option value="Axis">Axis</option>
            <option value="Dissolve">Dissolve</option>
            <option value="Eano">Eano</option>
            <option value="HardSync">Hard Sync</option>
            <option value="Organ">Organ</option>
            <option value="Prism">Prism</option>
            <option value="Simple">Simple</option>
            <option value="Wavetable">Wavetable</option>
          </select>
        </td>
        <td>
          <span
            >Determines the type of synthesizer engine to use, affecting the
            timbre and characteristics of the sound.</span
          >
        </td>
      </tr>
      <tr>
        <td>Brightness:</td>
        <td>
          <input type="range" id="brightness" min="0" max="100" value="50" />
        </td>
        <td><span id="brightnessValue">0.5</span></td>
        <td>
          <span
            >Controls the tonal brightness of the sound, ranging from dark and
            muted to bright and sharp. A darker sound emphasizes lower
            frequencies and can feel warm or subdued, while a brighter sound
            emphasizes higher frequencies, creating clarity and sharpness.</span
          >
        </td>
      </tr>
      <tr>
        <td>Movement:</td>
        <td>
          <input type="range" id="movement" min="0" max="100" value="50" />
        </td>
        <td><span id="movementValue">0.5</span></td>
        <td>
          <span
            >Adjusts the dynamic modulation of the sound, creating a sense of
            motion or stability.</span
          >
        </td>
      </tr>
      <tr>
        <td>Complexity:</td>
        <td>
          <input type="range" id="complexity" min="0" max="100" value="50" />
        </td>
        <td><span id="complexityValue">0.5</span></td>
        <td>
          <span
            >Determines the intricacy of the sound, influencing its layering and
            harmonic depth. Higher complexity can introduce richer harmonics,
            more active modulation, or additional notes, while lower complexity
            keeps the sound simpler and cleaner.</span
          >
        </td>
      </tr>
      <tr>
        <td>Character:</td>
        <td>
          <input type="range" id="character" min="0" max="100" value="50" />
        </td>
        <td><span id="characterValue">0.5</span></td>
        <td>
          <span
            >Defines the tonal personality of the sound, such as smooth, gritty,
            or textured. higher character values might increase the amount of
            grit in a bassline, add shimmering harmonics to a lead, or emphasize
            modulated textures in a pad. Lower character values could smooth out
            the sound, making it more neutral or clean. It also influences
            secondary effects, like the intensity of modulation or the
            responsiveness of filters and envelopes.</span
          >
        </td>
      </tr>
      <tr>
        <td>Resonance:</td>
        <td>
          <input type="range" id="resonance" min="0" max="100" value="50" />
        </td>
        <td><span id="resonanceValue">0.5</span></td>
        <td>
          <span
            >Emphasizes frequencies around the filter cutoff point, affecting
            the sharpness of the sound. High resonance can also create a
            distinct ringing or whistling effect at the cutoff frequency, add a
            sense of movement as the filter sweeps, and even push the filter
            into self-oscillation for unique tonal effects.</span
          >
        </td>
      </tr>
      <tr>
        <td>Spatial Width:</td>
        <td>
          <input type="range" id="spatialWidth" min="0" max="100" value="50" />
        </td>
        <td><span id="spatialWidthValue">0.5</span></td>
        <td>
          <span
            >Controls the stereo width of the sound, from mono to wide and
            spacious.</span
          >
        </td>
      </tr>
    </table>

    <table class="patch-controls">
      <tr>
        <td>Synth on Track 1:</td>
        <td>
          <select id="track1Synth"></select>
        </td>
        <td>Synth on Track 5:</td>
        <td>
          <select id="track5Synth"></select>
        </td>
        <td>FX1:</td>
        <td>
          <select id="fx1Select"></select>
        </td>
      </tr>
      <tr>
        <td>Synth on Track 2:</td>
        <td>
          <select id="track2Synth"></select>
        </td>
        <td>Synth on Track 6:</td>
        <td>
          <select id="track6Synth"></select>
        </td>
        <td>FX2:</td>
        <td>
          <select id="fx2Select"></select>
        </td>
      </tr>
      <tr>
        <td>Synth on Track 3:</td>
        <td>
          <select id="track3Synth"></select>
        </td>
        <td>Synth on Track 7:</td>
        <td>
          <select id="track7Synth"></select>
        </td>
      </tr>
      <tr>
        <td>Synth on Track 4:</td>
        <td>
          <select id="track4Synth"></select>
        </td>
        <td>Synth on Track 8:</td>
        <td>
          <select id="track8Synth"></select>
        </td>
      </tr>
    </table>

    <button id="generateBtn">Generate Random Patch</button>

    <div id="patch-details">
      <h2>About This Patch</h2>
      <ul id="patch-details-list"></ul>
    </div>

    <script>
      var opxy;

      document.addEventListener("DOMContentLoaded", () => {
        // Create and initialize the OPXY instance
        opxy = new OPXY();

        // Dynamically create option elements for track1Synth to track8Synth
        const synthOptions = [
          "Axis",
          "Dissolve",
          "Eano",
          "HardSync",
          "Organ",
          "Prism",
          "Simple",
          "Wavetable",
        ];
        for (let i = 1; i <= 8; i++) {
          const trackSelect = document.getElementById(`track${i}Synth`);
          synthOptions.forEach((synth, index) => {
            const option = document.createElement("option");
            option.value = synth;
            option.textContent = synth;
            if (index === i - 1) {
              option.selected = true;
            }
            trackSelect.appendChild(option);
          });
        }

        const fxOptions = ["Chorus", "Delay", "Distortion", "Reverb"];
        ["fx1Select", "fx2Select"].forEach((fxId) => {
          const fxSelect = document.getElementById(fxId);
          fxOptions.forEach((fx) => {
            const option = document.createElement("option");
            option.value = fx;
            option.textContent = fx;
            if (
              (fxId === "fx1Select" && fx === "Delay") ||
              (fxId === "fx2Select" && fx === "Reverb")
            ) {
              option.selected = true;
            }
            fxSelect.appendChild(option);
          });
        });

        document.getElementById("generateBtn").onclick = () => {
          const getSliderValue = (id) =>
            document.getElementById(id).value / 100;

          // Turn off any currently running automations
          opxy.clearSequencesAndAutomations();

          opxy.generateAndApplyPatch({
            patchType: document.getElementById("patchType").value,
            engineSelection: document.getElementById("engineType").value,
            brightness: getSliderValue("brightness"),
            movement: getSliderValue("movement"),
            complexity: getSliderValue("complexity"),
            character: getSliderValue("character"),
            resonance: getSliderValue("resonance"),
            spatialWidth: getSliderValue("spatialWidth"),
            track1Synth: document.getElementById("track1Synth").value,
            track2Synth: document.getElementById("track2Synth").value,
            track3Synth: document.getElementById("track3Synth").value,
            track4Synth: document.getElementById("track4Synth").value,
            track5Synth: document.getElementById("track5Synth").value,
            track6Synth: document.getElementById("track6Synth").value,
            track7Synth: document.getElementById("track7Synth").value,
            track8Synth: document.getElementById("track8Synth").value,
            fx1: document.getElementById("fx1Select").value,
            fx2: document.getElementById("fx2Select").value,
          });
        };

        opxy.initialize().then(() => {
          console.log("OPXY initialized and ready");
        });
        // Log the initial state of all tracks
        opxy.tracks.forEach((track, trackName) => {
          console.log(`Track ${trackName} initial state:`, {
            channel: track.channel,
            parameters: track.parameters,
            automations: Array.from(track.automations.entries()),
          });
        });
      });
    </script>
  </body>
</html>
